{"version":3,"sources":["components/common/Context.js","providers/userReducer.js","providers/Provider.js","components/helpers/setAuthToken.js","components/theme/Header.js","components/common/Layout.js","components/AppWrapper.js","components/Gallery.js","components/Upload.js","components/common/NotFound.js","components/common/Form.js","components/Login.js","App.js","serviceWorker.js","index.js","images/traakki.jpg"],"names":["Context","createContext","user","action","type","isLoggedIn","data","payload","children","useReducer","userReducer","dispatchUserAction","Provider","value","token","axios","defaults","headers","common","siteTitle","logout","style","background","marginBottom","padding","className","margin","to","color","textDecoration","onClick","navigate","Header","AppWrapper","useContext","useState","loading","setLoading","useEffect","fetchUser","a","window","localStorage","getItem","method","url","setAuthToken","setItem","location","pathname","Layout","removeItem","err","console","log","apiListToContent","apiList","map","img","w","h","img_width","img_height","imgDims","rows","availDims","screen","availWidth","availHeight","dimRatios","_","c","row","imgD","screenD","newRatio","Math","max","retDims","d","min","thumbDims","Number","key","Key","src","thumbnail","thumbnailWidth","thumbnailHeight","tagString","tags","split","filter","t","title","isSelected","fetchImageList","get","getImageList","imageListData","Gallery","setFilter","fullImageList","setFullImageList","imageList","setImageList","changeInd","setChangeInd","freshImageList","requestAndUpdateImages","filteredList","includes","forEach","e","dlKeys","post","responseType","then","response","fileURL","URL","createObjectURL","Blob","fileLink","document","createElement","href","setAttribute","floor","Date","now","body","appendChild","click","catch","error","onChange","target","replace","toLocaleLowerCase","placeholder","name","images","onSelectImage","i","Upload","setTags","getUploadParams","file","meta","aux","width","toString","height","apiUrl","fields","fileUrl","onChangeStatus","status","onSubmit","files","allFiles","f","remove","accept","inputContent","extra","reject","styles","dropzoneReject","borderColor","backgroundColor","inputLabel","Form","form","isSubmitting","setSubmitting","password","details","setDetails","errors","setErrors","handleSubmit","preventDefault","email","onBlur","disabled","useStyles","makeStyles","root","border","borderRadius","boxShadow","Landing","classes","Traakki","alt","App","path","component","Login","NotFound","default","Boolean","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister","message","module","exports"],"mappings":"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","file":"static/js/main.28519f12.chunk.js","sourcesContent":["import { createContext } from 'react'\n\nconst Context = createContext({})\n\nexport default Context\n","export default (user, action) => {\n  switch (action.type) {\n    case 'SAVE_USER':\n      return {\n        ...user,\n        isLoggedIn: true,\n        data: action.payload,\n      }\n    case 'LOGOUT':\n      return {\n        ...user,\n        isLoggedIn: false,\n        data: {},\n      }\n    default:\n      return user\n  }\n}\n","import React, { useReducer } from 'react'\nimport Context from '../components/common/Context'\nimport userReducer from './userReducer'\n\nexport default ({ children }) => {\n  const [user, dispatchUserAction] = useReducer(userReducer, {})\n\n  return (\n    <Context.Provider\n      value={{\n        user,\n        dispatchUserAction,\n      }}\n    >\n      {children}\n    </Context.Provider>\n  )\n}\n","import axios from 'axios'\n\nexport default token => {\n  if (token) {\n    axios.defaults.headers.common['x-auth'] = token\n  } else {\n    delete axios.defaults.headers.common['x-auth']\n  }\n}\n","import React from \"react\";\nimport { Link, navigate } from \"@reach/router\";\n\nexport default ({ siteTitle, isLoggedIn, logout }) => (\n  <header\n    style={{\n      background: `rebeccapurple`,\n      marginBottom: `1.45rem`,\n      padding: \"1rem 0\"\n    }}\n  >\n    <div className=\"flex-container container\">\n      <div className=\"text-left\">\n        <h1 style={{ margin: 0 }}>\n          <Link\n            to=\"/\"\n            style={{\n              color: `white`,\n              textDecoration: `none`\n            }}\n          >\n            {siteTitle}\n          </Link>\n        </h1>\n      </div>\n      {isLoggedIn && (\n        <div className=\"text-right\">\n          <button\n            type=\"button\"\n            onClick={() => {\n              navigate(\"/app/gallery\");\n            }}\n            className=\"btn btn-primary gradient-green\"\n          >\n            gallery\n          </button>\n          <button\n            type=\"button\"\n            onClick={() => {\n              navigate(\"/app/gallery/upload\");\n            }}\n            className=\"btn btn-primary gradient-green\"\n          >\n            upload\n          </button>\n          <button\n            type=\"submit\"\n            onClick={logout}\n            className=\"btn btn-primary gradient-green\"\n          >\n            logout\n          </button>\n        </div>\n      )}\n      {!isLoggedIn && (\n        <div className=\"text-right\">\n          <button\n            type=\"button\"\n            onClick={() => {\n              navigate(\"/app/login/\");\n            }}\n            className=\"btn btn-primary gradient-green\"\n          >\n            login\n          </button>\n        </div>\n      )}\n    </div>\n  </header>\n);\n","import React from \"react\";\r\nimport Header from \"../theme/Header\";\r\nimport \"./layout.css\";\r\n\r\nexport default ({ children, isLoggedIn, logout }) => {\r\n  return (\r\n    <>\r\n      <Header\r\n        siteTitle={`Gallery App`}\r\n        isLoggedIn={isLoggedIn}\r\n        logout={logout}\r\n      />\r\n      <main>{children}</main>\r\n    </>\r\n  );\r\n};\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { navigate } from \"@reach/router\";\r\nimport setAuthToken from \"./helpers/setAuthToken\";\r\nimport Layout from \"./common/Layout\";\r\nimport Context from \"./common/Context\";\r\n\r\n//client side only\r\nimport axios from \"axios\";\r\n\r\nconst AppWrapper = ({ children }) => {\r\n  const { user, dispatchUserAction } = useContext(Context);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const logout = () => {\r\n    try {\r\n      dispatchUserAction({ type: \"LOGOUT\" });\r\n      window.localStorage.removeItem(\"token\");\r\n      setAuthToken(false);\r\n      navigate(\"/\");\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchUser = async () => {\r\n      try {\r\n        const token = window.localStorage.getItem(\"token\");\r\n        if (token) {\r\n          const { data } = await axios({\r\n            method: \"GET\",\r\n            url: `/api/user/verify`,\r\n            headers: {\r\n              \"Content-Type\": \"text/plain\",\r\n              \"x-auth\": token\r\n            }\r\n          });\r\n\r\n          await setAuthToken(data.token);\r\n          dispatchUserAction({ type: \"SAVE_USER\", payload: \"any\" });\r\n          window.localStorage.setItem(\"token\", data.token);\r\n\r\n          if (\r\n            window.location.pathname === \"/app/login\" ||\r\n            window.location.pathname === \"/app/register\" ||\r\n            window.location.pathname === \"/app\" ||\r\n            window.location.pathname === \"/app/login/\" ||\r\n            window.location.pathname === \"/app/register/\" ||\r\n            window.location.pathname === \"/app/\"\r\n          ) {\r\n            navigate(\"/app/gallery/\");\r\n          }\r\n          setLoading(false);\r\n        } else {\r\n          if (\r\n            window.location.pathname === \"/app/gallery\" ||\r\n            window.location.pathname === \"/app/gallery/\" ||\r\n            window.location.pathname === \"/app/upload\" ||\r\n            window.location.pathname === \"/app/upload/\"\r\n          ) {\r\n            navigate(\"/app/login/\");\r\n          }\r\n          setLoading(false);\r\n        }\r\n      } catch (err) {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    if (!user.isLoggedIn) {\r\n      fetchUser();\r\n    }\r\n  }, [user, dispatchUserAction]);\r\n\r\n  return (\r\n    <>\r\n      {loading ? (\r\n        <span>Loading...</span>\r\n      ) : (\r\n        <Layout isLoggedIn={user.isLoggedIn} logout={logout}>\r\n          {children}\r\n        </Layout>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AppWrapper;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport GridGallery from \"react-grid-gallery\";\r\n\r\n//client side only\r\nimport axios from \"axios\";\r\n\r\nconst apiListToContent = apiList => {\r\n  // https://stackoverflow.com/a/10284006/7735591\r\n  const zip = rows => rows[0].map((_, c) => rows.map(row => row[c]));\r\n\r\n  //scale image so that image covers 0.1*screen.availWidth while ensuring at least 80 pix dims\r\n  const thumbDims = imgDims => {\r\n    const MIN_D = 80;\r\n    const availDims = [window.screen.availWidth, window.screen.availHeight];\r\n    const dimRatios = zip([imgDims, availDims]).map(\r\n      (imgD, screenD) => imgD / screenD\r\n    );\r\n    const newRatio = 0.1 / Math.max(...dimRatios);\r\n    const retDims = imgDims.map(d => d * newRatio);\r\n    return Math.min(...retDims) > MIN_D\r\n      ? retDims\r\n      : retDims.map(d => (d * MIN_D) / Math.min(...retDims));\r\n  };\r\n  return apiList.map(img => {\r\n    let w, h;\r\n    if (img.img_width && img.img_height) {\r\n      [w, h] = thumbDims([img.img_width, img.img_height].map(Number));\r\n    }\r\n    return {\r\n      key: img.Key,\r\n      src: img.url,\r\n      thumbnail: img.url,\r\n      thumbnailWidth: w || 100,\r\n      thumbnailHeight: h || 100,\r\n      tagString: img.tags,\r\n      tags: img.tags\r\n        .split(\",\")\r\n        .filter(t => t !== \"\")\r\n        .map(t => ({ value: t, title: t })),\r\n      isSelected: false\r\n    };\r\n  });\r\n};\r\n\r\nconst fetchImageList = async () => {\r\n  const { data } = await axios.get(`/api/images/all`);\r\n  return data;\r\n};\r\n\r\nconst getImageList = async () => {\r\n  const imageListData = await fetchImageList();\r\n  return apiListToContent(imageListData);\r\n};\r\n\r\nconst Gallery = () => {\r\n  const [filter, setFilter] = useState(\"\");\r\n  const [fullImageList, setFullImageList] = useState();\r\n  const [imageList, setImageList] = useState();\r\n  const [changeInd, setChangeInd] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const requestAndUpdateImages = async () => {\r\n      const freshImageList = await getImageList();\r\n      setFullImageList(freshImageList);\r\n      setImageList(freshImageList);\r\n    };\r\n    requestAndUpdateImages();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (fullImageList) {\r\n      const filteredList = fullImageList.filter(\r\n        img => img.tagString.includes(filter) || img.isSelected\r\n      );\r\n      setImageList(filteredList);\r\n    }\r\n    return () => {\r\n      setChangeInd(false);\r\n    };\r\n  }, [filter, changeInd, fullImageList]);\r\n\r\n  const tagFilterChangeHandler = e => {\r\n    setFilter(\r\n      e.target.value.replace(/[ #*;,.<>\\{\\}\\[\\]\\\\\\/]/gi, \"\").toLocaleLowerCase()\r\n    );\r\n  };\r\n\r\n  //Ref: SO\r\n  const handleDownloadSelected = e => {\r\n    const dlKeys = imageList.filter(img => img.isSelected).map(img => img.key);\r\n    axios\r\n      .post(`/api/s3/zip`, dlKeys, {\r\n        responseType: \"arraybuffer\"\r\n      })\r\n      .then(response => {\r\n        const fileURL = window.URL.createObjectURL(new Blob([response.data]));\r\n        const fileLink = document.createElement(\"a\");\r\n        fileLink.href = fileURL;\r\n        fileLink.setAttribute(\r\n          \"download\",\r\n          `${Math.floor(Date.now() / 1000)}_tenerife20.zip`\r\n        );\r\n        document.body.appendChild(fileLink);\r\n        fileLink.click();\r\n      })\r\n      .catch(err =>\r\n        console.error(`could not download selected\r\n        ${err}`)\r\n      );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {imageList && (\r\n        <>\r\n          <div>\r\n            <div className=\"parent grid-parent\">\r\n              <h2 className=\"child\">Tag Filter</h2>\r\n              <button\r\n                onClick={() => {\r\n                  imageList.forEach(img => {\r\n                    img.isSelected = true;\r\n                  });\r\n                  setChangeInd(true);\r\n                }}\r\n                className=\"child btn btn-primary gradient-green\"\r\n              >\r\n                select all\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  imageList.forEach(img => {\r\n                    img.isSelected = false;\r\n                  });\r\n                  setChangeInd(true);\r\n                }}\r\n                className=\"child btn btn-primary gradient-green\"\r\n              >\r\n                clear selection\r\n              </button>\r\n              <button\r\n                onClick={handleDownloadSelected}\r\n                className=\"child btn btn-primary gradient-green\"\r\n              >\r\n                download selected\r\n              </button>\r\n            </div>\r\n            <input\r\n              onChange={tagFilterChangeHandler}\r\n              value={filter}\r\n              placeholder='Type to filter by tag e.g. \"teide\"'\r\n              name=\"tagsField\"\r\n              type=\"text\"\r\n            />\r\n          </div>\r\n          <GridGallery\r\n            images={imageList}\r\n            onSelectImage={(i, img) => {\r\n              imageList[i].isSelected = !img.isSelected;\r\n            }}\r\n          />\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Gallery;\r\n","import React, { useState } from \"react\";\r\n\r\n//client side only\r\nimport \"react-dropzone-uploader/dist/styles.css\";\r\nimport axios from \"axios\";\r\nimport Dropzone from \"react-dropzone-uploader\";\r\n\r\nconst Upload = () => {\r\n  const [tags, setTags] = useState(\"\");\r\n\r\n  const ImageAudioVideo = () => {\r\n    const getUploadParams = async ({ file, meta }) => {\r\n      const aux = {\r\n        \"x-amz-meta-img_width\": meta.width.toString(),\r\n        \"x-amz-meta-img_height\": meta.height.toString(),\r\n        \"x-amz-meta-tag_string\": tags\r\n      };\r\n      const apiUrl = `/api/s3/file/${meta.name}`;\r\n      const { data } = await axios.post(apiUrl, { aux });\r\n      const { url, fields } = data;\r\n      const fileUrl = `${url}/${fields.key}`;\r\n      return { fields, meta: { fileUrl }, url };\r\n    };\r\n\r\n    const handleChangeStatus = ({ meta }, status) => {\r\n      console.log(status, meta);\r\n    };\r\n\r\n    const handleSubmit = (files, allFiles) => {\r\n      console.log(files.map(f => f.meta));\r\n      allFiles.forEach(f => f.remove());\r\n    };\r\n\r\n    return (\r\n      <>\r\n        <Dropzone\r\n          getUploadParams={getUploadParams}\r\n          onChangeStatus={handleChangeStatus}\r\n          onSubmit={handleSubmit}\r\n          accept=\"image/*,audio/*,video/*\"\r\n          inputContent={(files, extra) =>\r\n            extra.reject\r\n              ? \"Image, audio and video files only\"\r\n              : \"Click or Drop (multiple)\"\r\n          }\r\n          styles={{\r\n            dropzoneReject: { borderColor: \"red\", backgroundColor: \"#DAA\" },\r\n            inputLabel: (files, extra) => (extra.reject ? { color: \"red\" } : {})\r\n          }}\r\n        />\r\n      </>\r\n    );\r\n  };\r\n\r\n  const tagChangeHandler = e => {\r\n    setTags(\r\n      e.target.value.replace(/[ #*;.<>\\{\\}\\[\\]\\\\\\/]/gi, \"\").toLocaleLowerCase()\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <h2>\r\n        Tags for pictures comma-separated e.g.{\" \"}\r\n        {\"<photographer>,<place> (oscar,teide)\"}\r\n      </h2>\r\n      <input\r\n        onChange={tagChangeHandler}\r\n        value={tags}\r\n        placeholder=\"optional\"\r\n        name=\"tagsField\"\r\n        type=\"text\"\r\n      />\r\n      <ImageAudioVideo />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Upload;\r\n","import React from 'react'\nimport Layout from './Layout'\n\nexport default () => (\n  <Layout>\n    <h1>NOT FOUND</h1>\n    <p>You just hit a route that doesn&#39;t exist... the sadness.</p>\n  </Layout>\n)\n","import React, { useContext, useState } from \"react\";\nimport { navigate } from \"@reach/router\";\nimport Context from \"./Context\";\n\n//client-side only\nimport axios from \"axios\";\nimport setAuthToken from \"../helpers/setAuthToken\";\n\nconst Form = ({ form }) => {\n  const { dispatchUserAction } = useContext(Context);\n  const [isSubmitting, setSubmitting] = useState(false);\n  const [details, setDetails] = useState({\n    password: \"\"\n  });\n  const [errors, setErrors] = useState({\n    password: \"\"\n  });\n\n  const handleChange = e => {\n    setDetails({ ...details, [e.target.name]: e.target.value });\n  };\n\n  const handleBlur = e => {\n    if (!e.target.value) {\n      setErrors({ ...errors, [e.target.name]: \"Required field\" });\n    }\n  };\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setSubmitting(true);\n\n    try {\n      const { password } = details;\n\n      if (form === \"login\") {\n        if (!password) {\n          setSubmitting(false);\n          setErrors({\n            ...errors,\n            password: \"Field is required\"\n          });\n        } else {\n          const { data } = await axios.post(`/api/user/login`, {\n            password\n          });\n\n          await setAuthToken(data.token);\n          dispatchUserAction({ type: \"SAVE_USER\", payload: data });\n          window.localStorage.setItem(\"token\", data.token);\n          navigate(\"/app/gallery/\");\n        }\n      }\n    } catch (err) {\n      setErrors({\n        ...errors,\n        email:\n          (err.response && err.response.data && err.response.error) ||\n          \"Could not authenticate\"\n      });\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"container\">\n      <form onSubmit={handleSubmit}>\n        <div className=\"input-field black-input\">\n          <span className=\"lock-icon\" />\n          <input\n            onChange={handleChange}\n            onBlur={handleBlur}\n            type=\"password\"\n            placeholder=\"secreto/tunnussana\"\n            name=\"password\"\n          />\n          {errors.password && (\n            <span style={{ color: \"red\" }}>{errors.password}</span>\n          )}\n        </div>\n        <div className=\"center-text\">\n          <button\n            type=\"submit\"\n            disabled={isSubmitting}\n            className=\"btn btn-rounded gradient-green\"\n          >\n            ENTRAR/SISÄÄN\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n};\n\nexport default Form;\n","import React from 'react'\nimport Form from '../components/common/Form'\n\nexport default () => (\n  <>\n    <Form form=\"login\" />\n  </>\n)\n","import React from \"react\";\nimport Traakki from \"./images/traakki.jpg\";\nimport { Router, Link } from \"@reach/router\";\nimport Provider from \"./providers/Provider\";\nimport AppWrapper from \"./components/AppWrapper\";\nimport Gallery from \"./components/Gallery\";\nimport Upload from \"./components/Upload\";\nimport NotFound from \"./components/common/NotFound\";\nimport Login from \"./components/Login\";\nimport \"./App.css\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport Img from \"react-image\";\n\nconst useStyles = makeStyles({\n  root: {\n    background: \"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)\",\n    border: 0,\n    borderRadius: 3,\n    boxShadow: \"0 3px 5px 2px rgba(255, 105, 135, .3)\",\n    color: \"white\",\n    height: 48,\n    padding: \"0 30px\"\n  }\n});\n\nfunction Landing() {\n  const classes = useStyles();\n  return (\n    <>\n      <div className=\"container center-text\">\n        <h1>Galeria de los 60 de Lister en Tenerife 2020</h1>\n        <h1>Kuvagalleria Lister 60 Tenerife 2020</h1>\n      </div>\n      <div>\n        <Link className={classes.root} to=\"/app/login/\">\n          Login\n        </Link>\n      </div>\n      <Img src={Traakki} alt=\"Traakki\" />\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <Provider>\n      <AppWrapper>\n        <Router>\n          <Landing path=\"/\" component={Landing} />\n          <Landing path=\"/app/\" component={Landing} />\n          <Login path=\"/app/login/\" component={Login} />\n          <Gallery path=\"/app/gallery/\" component={Gallery} />\n          <Upload path=\"/app/gallery/upload/\" component={Upload} />\n          <NotFound default component={NotFound} />\n        </Router>\n      </AppWrapper>\n    </Provider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n\nserviceWorker.unregister();\n","module.exports = __webpack_public_path__ + \"static/media/traakki.d2f4d2b4.jpg\";"],"sourceRoot":""}